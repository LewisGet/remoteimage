<?php
/**
 * @package     Joomla.Administrator
 * @subpackage  com_remoteimage
 *
 * @copyright   Copyright (C) 2012 Asikart. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 * @author      Generated by AKHelper - http://asikart.com
 */

// no direct access
defined('_JEXEC') or die;


// Init some API objects
// ================================================================================
$date 	= JFactory::getDate( 'now' , JFactory::getConfig()->get('offset') ) ;
$doc 	= JFactory::getDocument() ;
$uri 	= JFactory::getURI() ;
$user	= JFactory::getUser() ;
$app 	= JFactory::getApplication() ;


// Include elFinder and JS
// ================================================================================
JHtml::_('behavior.tooltip');
JHtml::_('jquery.framework', true);
$doc->addStylesheet( 'components/com_akquickicons/includes/jquery-ui/css/smoothness/jquery-ui-1.8.24.custom.css' );
$doc->addscript( 'components/com_akquickicons/includes/jquery-ui/js/jquery-ui-1.8.24.custom.min.js' );
$doc->addStylesheet( 'components/com_remoteimage/includes/js/elfinder/css/elfinder.min.css' );
$doc->addStylesheet( 'components/com_remoteimage/includes/js/elfinder/css/theme.css' );
JHtml::script( JURI::base().'components/com_remoteimage/includes/js/elfinder/js/elfinder.min.js' );
RMHelper::_('include.core');


/* jsTree
RMHelper::_('include.addJS', 'jstree/_lib/jquery.cookie.js');
RMHelper::_('include.addJS', 'jstree/_lib/jquery.hotkeys.js');
RMHelper::_('include.addJS', 'jstree/jquery.jstree.js');
RMHelper::_('include.addJS', 'folder-tree.js');
*/



if( JVERSION >= 3){
	JHtml::_('formbehavior.chosen', 'select');
	if($app->isSite()){
		//RemoteimageHelper::_('include.fixBootstrapToJoomla');
	}
}else{
	RemoteimageHelper::_('include.bluestork');
	// RemoteimageHelper::_('include.fixBootstrapToJoomla');
}



// For Site
// ================================================================================
if($app->isSite()) {
	RemoteimageHelper::_('include.isis');
}



?>
<script type="text/javascript">
	var insertImageToParent = function(){
		var imgs 	= elSelected ;
		
		if( elSelected.length < 1 ) {
			return ;
		}
		
		var dW 		= $('rm-width').get('value').toInt() ;
		//var dH 		= $('rm-height').get('value').toInt() ;
		var tags	= '';
		
		imgs.each( function(e, i){
			
			// Create img element
			var img = new Element('img', {
				alt : e.name ,
				src : e.url ,
				width : dW
			}) ;
			
			tags += '<p>' + img.outerHTML + '</p>';
		} );
		
		
		if (window.parent) window.parent.insertImage(tags);
	}
</script>

<div id="remoteimage-manager" class="<?php echo (JVERSION >= 3) ? 'joomla30' : 'joomla25' ?>">

		<!-- Bodys -->
		<div class="row-fluid">
			<div id="elfinder" class="span12 rm-finder">
				
			</div>
		</div>
		
		
		<?php if( $this->modal ): ?>
		<div class="row-fluid">
			<div class="span12 form-actions">
				<label for="rm-width" class="fltlft pull-left"><?php echo JText::_('COM_REMOTEIMAGE_MAX_WIDTH'); ?></label>
				<input type="text" id="rm-width" class="input input-mini fltlft pull-left" value="<?php echo $this->params->get('Image_DefaultWidth_Midium', 640); ?>" />
				<!--<span class="rm-width-height-x">X</span>
				<input type="text" id="rm-height" class="input input-mini" value="<?php echo $this->params->get('Image_DefaultHeight_Midium', 640); ?>" />
				-->
				<div class="btn-toolbar pull-right">
					
					<button id="rm-insert-button" class="btn btn-primary" onclick="window.insertImageToParent();">
						<?php echo JText::_('COM_REMOTEIMAGE_INSERT_IMAGES'); ?>
					</button>
					
					<button id="rm-cancel-button" class="btn">
						<?php echo JText::_('JLIB_HTML_BEHAVIOR_CLOSE'); ?>
					</button>
					
				</div>
			</div>
		</div>
		<?php endif; ?>

</div>